<% content_for :title, "Detalle de Producto en Servicio" %>

<div class="max-w-4xl mx-auto px-4 py-6">
  <!-- Header -->
  <div class="flex justify-between items-start mb-6">
    <div>
      <h1 class="text-3xl font-bold text-gray-900">Producto en Servicio</h1>
      <p class="text-gray-600 mt-1">Detalle del producto utilizado en este servicio</p>
    </div>
    
    <div class="flex space-x-3">
      <%= link_to "Volver al Servicio", detalles_servicio_vehiculo_path(@detalle_servicio_vehiculo),
          class: "bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded-md font-medium transition-colors" %>
      
      <%= link_to "Editar", edit_detalles_servicio_vehiculo_detalles_servicio_producto_path(@detalle_servicio_vehiculo, @detalle_servicio_producto),
          class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors" %>
    </div>
  </div>

  <!-- Información del Servicio -->
  <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
    <h3 class="text-lg font-semibold text-blue-900 mb-2">Información del Servicio</h3>
    <div class="grid grid-cols-2 gap-4 text-sm">
      <div>
        <span class="font-medium text-blue-800">Servicio:</span>
        <span class="text-blue-900"><%= @detalle_servicio_vehiculo.servicio.nombre %></span>
      </div>
      <div>
        <span class="font-medium text-blue-800">Vehículo:</span>
        <span class="text-blue-900"><%= @detalle_servicio_vehiculo.vehiculo.matricula %></span>
      </div>
      <div>
        <span class="font-medium text-blue-800">Cliente:</span>
        <span class="text-blue-900"><%= @detalle_servicio_vehiculo.cliente.nombre %> <%= @detalle_servicio_vehiculo.cliente.apellido %></span>
      </div>
      <div>
        <span class="font-medium text-blue-800">Estado:</span>
        <span class="text-blue-900"><%= @detalle_servicio_vehiculo.estado %></span>
      </div>
    </div>
  </div>

  <!-- Detalles del Producto -->
  <div class="bg-white shadow rounded-lg">
    <div class="px-6 py-4 border-b border-gray-200">
      <h2 class="text-xl font-semibold text-gray-900">Producto Utilizado</h2>
    </div>
    
    <div class="px-6 py-4">
      <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
        <!-- Información del Producto -->
        <div>
          <h3 class="text-lg font-medium text-gray-900 mb-4">Información del Producto</h3>
          <div class="space-y-3">
            <div>
              <dt class="text-sm font-medium text-gray-500">Nombre</dt>
              <dd class="mt-1 text-lg font-semibold text-gray-900"><%= @detalle_servicio_producto.producto.nombre %></dd>
            </div>
            
            <div>
              <dt class="text-sm font-medium text-gray-500">Descripción</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <%= @detalle_servicio_producto.producto.descripcion.present? ? @detalle_servicio_producto.producto.descripcion : "Sin descripción" %>
              </dd>
            </div>
            
            <div>
              <dt class="text-sm font-medium text-gray-500">Proveedor</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <%= @detalle_servicio_producto.producto.proveedor&.nombre || "Sin proveedor asignado" %>
              </dd>
            </div>
          </div>
        </div>

        <!-- Detalles de Uso -->
        <div>
          <h3 class="text-lg font-medium text-gray-900 mb-4">Detalles de Uso en el Servicio</h3>
          <div class="space-y-3">
            <div>
              <dt class="text-sm font-medium text-gray-500">Cantidad Utilizada</dt>
              <dd class="mt-1 text-lg font-semibold text-blue-600"><%= @detalle_servicio_producto.cantidad_usada %></dd>
            </div>
            
            <div>
              <dt class="text-sm font-medium text-gray-500">Precio Unitario</dt>
              <dd class="mt-1 text-lg font-semibold text-green-600">$<%= number_with_delimiter(@detalle_servicio_producto.precio_unitario, delimiter: ",") %></dd>
            </div>
            
            <div>
              <dt class="text-sm font-medium text-gray-500">Total</dt>
              <dd class="mt-1 text-2xl font-bold text-gray-900">
                $<%= number_with_delimiter(@detalle_servicio_producto.cantidad_usada * @detalle_servicio_producto.precio_unitario, delimiter: ",") %>
              </dd>
            </div>
            
            <div>
              <dt class="text-sm font-medium text-gray-500">Stock Restante del Producto</dt>
              <dd class="mt-1 text-sm text-gray-900">
                <%= @detalle_servicio_producto.producto.cantidad_disponible %> unidades disponibles
              </dd>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Acciones -->
    <div class="px-6 py-4 bg-gray-50 border-t border-gray-200 flex justify-between">
      <div>
        <%= link_to "← Volver a Productos del Servicio", 
            detalles_servicio_vehiculo_detalles_servicio_productos_path(@detalle_servicio_vehiculo),
            class: "text-gray-600 hover:text-gray-900 font-medium" %>
      </div>
      
      <div class="space-x-3">
        <%= link_to "Editar Producto", 
            edit_detalles_servicio_vehiculo_detalles_servicio_producto_path(@detalle_servicio_vehiculo, @detalle_servicio_producto),
            class: "bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-md font-medium transition-colors" %>
        
        <%= link_to "Eliminar", 
            detalles_servicio_vehiculo_detalles_servicio_producto_path(@detalle_servicio_vehiculo, @detalle_servicio_producto),
            method: :delete,
            data: { confirm: "¿Estás seguro? Esto restaurará el stock del producto." },
            class: "bg-red-600 hover:bg-red-700 text-white px-4 py-2 rounded-md font-medium transition-colors" %>
      </div>
    </div>
  </div>
</div>