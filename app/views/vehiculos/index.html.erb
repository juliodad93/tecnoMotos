<div class="min-h-screen bg-gray-100 py-8">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="bg-white shadow rounded-lg">
      <!-- Header -->
      <div class="px-6 py-4 border-b border-gray-200">
        <div class="flex items-center justify-between">
          <h1 class="text-2xl font-bold text-gray-900">Todos los Vehículos</h1>
          <div class="flex gap-2">
            <%= link_to "Ver Clientes", clientes_path, 
                class: "bg-gray-600 hover:bg-gray-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200" %>
            <div class="relative">
              <select id="cliente-selector" onchange="redirectToNewVehiculo()" 
                      class="bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200 appearance-none pr-8">
                <option value="">Nuevo Vehículo</option>
                <% @clientes.each do |cliente| %>
                  <option value="<%= new_cliente_vehiculo_path(cliente) %>">
                    Para <%= "#{cliente.nombre} #{cliente.apellido}" %>
                  </option>
                <% end %>
              </select>
              <svg class="absolute right-2 top-3 w-4 h-4 text-white pointer-events-none" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
              </svg>
            </div>
          </div>
        </div>
      </div>

      <!-- Search Bar -->
      <div class="px-6 py-4 bg-gray-50">
        <div class="max-w-md">
          <input type="search" id="vehiculo-search" placeholder="Buscar vehículo..." 
                 class="w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                 onkeyup="filterVehiculos()">
        </div>
      </div>

      <!-- Vehicles Table -->
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-gray-200">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Vehículo</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Matrícula</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Propietario</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Año</th>
              <th class="px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Acciones</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-gray-200" id="vehiculos-tbody">
            <% @vehiculos.each do |vehiculo| %>
              <tr class="hover:bg-gray-50 vehiculo-row" data-search="<%= "#{vehiculo.marca} #{vehiculo.modelo} #{vehiculo.matricula} #{vehiculo.cliente.nombre} #{vehiculo.cliente.apellido} #{vehiculo.anio}".downcase %>">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="flex items-center">
                    <div class="flex-shrink-0 h-10 w-10">
                      <div class="h-10 w-10 rounded-lg bg-gray-200 flex items-center justify-center">
                        <svg class="h-6 w-6 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4M7.835 4.697a3.42 3.42 0 001.946-.806 3.42 3.42 0 014.438 0 3.42 3.42 0 001.946.806 3.42 3.42 0 013.138 3.138 3.42 3.42 0 00.806 1.946 3.42 3.42 0 010 4.438 3.42 3.42 0 00-.806 1.946 3.42 3.42 0 01-3.138 3.138 3.42 3.42 0 00-1.946.806 3.42 3.42 0 01-4.438 0 3.42 3.42 0 00-1.946-.806 3.42 3.42 0 01-3.138-3.138 3.42 3.42 0 00-.806-1.946 3.42 3.42 0 010-4.438 3.42 3.42 0 00.806-1.946 3.42 3.42 0 013.138-3.138z"></path>
                        </svg>
                      </div>
                    </div>
                    <div class="ml-4">
                      <div class="text-sm font-medium text-gray-900">
                        <%= vehiculo.marca %> <%= vehiculo.modelo %>
                      </div>
                      <div class="text-sm text-gray-500">
                        <%= vehiculo.color if vehiculo.color.present? %>
                      </div>
                    </div>
                  </div>
                </td>
                <td class="px-6 py-4 whitespace-nowrap">
                  <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                    <%= vehiculo.matricula %>
                  </span>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-900">
                  <%= link_to cliente_path(vehiculo.cliente), class: "text-blue-600 hover:text-blue-900" do %>
                    <%= vehiculo.cliente.nombre %> <%= vehiculo.cliente.apellido %>
                  <% end %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-500">
                  <%= vehiculo.anio %>
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-right text-sm font-medium">
                  <div class="flex items-center justify-end space-x-2">
                    <%= link_to "Ver", vehiculo_path(vehiculo), 
                        class: "text-blue-600 hover:text-blue-900 bg-blue-50 hover:bg-blue-100 px-3 py-1 rounded-md transition duration-200" %>
                    <%= link_to "Editar", edit_vehiculo_path(vehiculo), 
                        class: "text-yellow-600 hover:text-yellow-900 bg-yellow-50 hover:bg-yellow-100 px-3 py-1 rounded-md transition duration-200" %>
                    <%= link_to "Eliminar", vehiculo_path(vehiculo), 
                        method: :delete,
                        data: { 
                          confirm: "¿Estás seguro de que quieres eliminar este vehículo?" 
                        },
                        class: "text-red-600 hover:text-red-900 bg-red-50 hover:bg-red-100 px-3 py-1 rounded-md transition duration-200" %>
                  </div>
                </td>
              </tr>
            <% end %>
          </tbody>
        </table>
        
        <% if @vehiculos.empty? %>
          <div class="text-center py-12">
            <div class="text-gray-500">
              <h3 class="text-lg font-medium mb-2">No hay vehículos registrados</h3>
              <p class="mb-4">Comienza agregando el primer vehículo a un cliente</p>
              <%= link_to "Ver Clientes", clientes_path, 
                  class: "bg-blue-600 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg transition duration-200" %>
            </div>
          </div>
        <% end %>
      </div>
    </div>
  </div>
</div>

<script>
function redirectToNewVehiculo() {
  const selector = document.getElementById('cliente-selector');
  const url = selector.value;
  if (url) {
    window.location.href = url;
    // Reset selector
    selector.value = '';
  }
}

function filterVehiculos() {
  const searchTerm = document.getElementById('vehiculo-search').value.toLowerCase();
  const rows = document.querySelectorAll('.vehiculo-row');
  let visibleCount = 0;
  
  rows.forEach(row => {
    const searchData = row.getAttribute('data-search');
    if (searchData.includes(searchTerm)) {
      row.style.display = '';
      visibleCount++;
    } else {
      row.style.display = 'none';
    }
  });
  
  // Show/hide empty state message
  const emptyMessage = document.querySelector('.text-center.py-12');
  const tbody = document.getElementById('vehiculos-tbody');
  
  if (visibleCount === 0 && searchTerm !== '') {
    // Create or show "no results" message
    let noResultsMessage = document.getElementById('no-results-message');
    if (!noResultsMessage) {
      noResultsMessage = document.createElement('tr');
      noResultsMessage.id = 'no-results-message';
      noResultsMessage.innerHTML = `
        <td colspan="5" class="px-6 py-12 text-center">
          <div class="text-gray-500">
            <h3 class="text-lg font-medium mb-2">No se encontraron vehículos</h3>
            <p class="mb-4">No hay vehículos que coincidan con "<span id="search-term"></span>"</p>
          </div>
        </td>
      `;
      tbody.appendChild(noResultsMessage);
    }
    document.getElementById('search-term').textContent = searchTerm;
    noResultsMessage.style.display = '';
  } else {
    // Hide "no results" message
    const noResultsMessage = document.getElementById('no-results-message');
    if (noResultsMessage) {
      noResultsMessage.style.display = 'none';
    }
  }
}
</script>
